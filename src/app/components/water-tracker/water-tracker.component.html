<div class="water-tracker">
  <div class="tracker-container">
    <!-- Header -->
    <div class="header-section">
      <h1>Water Tracker</h1>
      <p class="subtitle">{{ getMotivationalMessage() }}</p>
    </div>

    <!-- Progress Section -->
    <div class="progress-section">
      <div class="progress-circle">
        <div class="water-glass">
          <div class="water-level" 
               [style.height.%]="getWaterLevelHeight()"
               [class]="getProgressBarClass()">
          </div>
          <div class="glass-text">
            <div class="percentage">{{ progressPercentage }}%</div>
            <div class="amount">{{ todayIntake }}ml</div>
            <div class="goal">of {{ dailyGoal }}ml</div>
          </div>
        </div>
      </div>

      <div class="progress-details">
        <div class="detail-item">
          <span class="label">Today's Progress</span>
          <span class="value">{{ todayIntake }}ml / {{ dailyGoal }}ml</span>
        </div>
        <div class="detail-item" *ngIf="remainingAmount > 0">
          <span class="label">Remaining</span>
          <span class="value">{{ remainingAmount }}ml</span>
        </div>
        <div class="detail-item" *ngIf="remainingAmount === 0">
          <span class="label">Goal Status</span>
          <span class="value achieved">üéØ Goal Achieved!</span>
        </div>
      </div>
    </div>

    <!-- Quick Log Section -->
    <div class="quick-log-section">
      <h3>Log Water Intake</h3>
      
      <div class="quick-amounts">
        <button 
          *ngFor="let amount of quickAmounts"
          class="quick-btn"
          (click)="logWaterIntake(amount)">
          {{ amount }}ml
        </button>
      </div>

      <div class="custom-amount">
        <label for="customAmount">Custom Amount</label>
        <div class="custom-input-group">
          <input 
            type="number" 
            id="customAmount"
            [(ngModel)]="customAmount" 
            min="1" 
            max="2000"
            class="custom-input">
          <span class="unit">ml</span>
          <button 
            class="add-btn"
            (click)="logWaterIntake(customAmount)"
            [disabled]="customAmount <= 0">
            Add
          </button>
        </div>
      </div>
    </div>

    <!-- Reminders Section -->
    <div class="reminders-section" *ngIf="isNotificationSupported()">
      <h3>Hydration Reminders</h3>
      <div class="reminder-toggle">
        <label class="toggle-switch">
          <input 
            type="checkbox" 
            [checked]="isRemindersEnabled"
            (change)="toggleReminders()">
          <span class="toggle-slider"></span>
        </label>
        <div class="toggle-text">
          <span class="toggle-label">
            {{ isRemindersEnabled ? 'Reminders On' : 'Reminders Off' }}
          </span>
          <small *ngIf="isRemindersEnabled && currentUser" class="toggle-info">
            Every {{ testMode ? testInterval : currentUser.reminderInterval }} minutes
          </small>
        </div>
      </div>
      
      <!-- Test Mode Controls -->
      <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 4px;">
        <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
          <input type="checkbox" [(ngModel)]="testMode" (change)="onTestModeChange()">
          <span>Test Mode (shorter intervals)</span>
        </label>
        <div *ngIf="testMode" style="display: flex; align-items: center; gap: 10px;">
          <label>Interval:</label>
          <select [(ngModel)]="testInterval" style="padding: 4px 8px;">
            <option value="0.1">6 seconds</option>
            <option value="0.5">30 seconds</option>
            <option value="1">1 minute</option>
            <option value="2">2 minutes</option>
            <option value="5">5 minutes</option>
          </select>
        </div>
      </div>
      
      <!-- Debug Test Buttons -->
      <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
        <button 
          class="test-btn"
          (click)="requestPermissionAgain()"
          style="padding: 8px 16px; background: #F44336; color: white; border: none; border-radius: 4px; cursor: pointer;">
          Request Permission
        </button>
        
        <button 
          class="test-btn"
          (click)="testNotification()"
          style="padding: 8px 16px; background: #FF9800; color: white; border: none; border-radius: 4px; cursor: pointer;">
          Test Service Notification
        </button>
        
        <button 
          class="test-btn"
          (click)="testDirectNotification()"
          style="padding: 8px 16px; background: #9C27B0; color: white; border: none; border-radius: 4px; cursor: pointer;">
          Test Direct Notification
        </button>
      </div>
    </div>

    <!-- Recent Intake History -->
    <div class="history-section" *ngIf="recentIntakes.length > 0">
      <h3>Today's Intake History</h3>
      <div class="intake-list">
        <div 
          *ngFor="let intake of recentIntakes" 
          class="intake-item">
          <div class="intake-info">
            <span class="intake-amount">{{ intake.amount }}ml</span>
            <span class="intake-time">{{ formatTime(intake.timestamp) }}</span>
          </div>
          <button 
            class="delete-btn"
            (click)="deleteIntake(intake)"
            title="Delete this entry">
            √ó
          </button>
        </div>
      </div>
    </div>

    <!-- No Profile Warning -->
    <div class="no-profile-warning" *ngIf="!currentUser">
      <div class="warning-content">
        <h3>üéØ Set Up Your Profile</h3>
        <p>To get personalized hydration recommendations and track your progress, please set up your profile first.</p>
        <a routerLink="/calculator" class="setup-btn">Calculate My Hydration Needs</a>
      </div>
    </div>

    <!-- Notification Not Supported Warning -->
    <div class="notification-warning" *ngIf="!isNotificationSupported()">
      <div class="warning-content">
        <h4>‚ö†Ô∏è Notifications Not Supported</h4>
        <p>Your browser doesn't support notifications. Reminders won't work, but you can still track your water intake manually.</p>
      </div>
    </div>
  </div>
</div>